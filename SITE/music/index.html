<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<meta name="theme-color" content="#91C6FF"/>
<title>训练提醒 · 分页版</title>
<link rel="manifest" href="manifest.json">
<style>
:root{
  --bg:#91C6FF; --panel:#ffffff; --ink:#111; --muted:#5b616a;
  --brand:#2563eb; --ok:#10b981; --warn:#f59e0b; --danger:#ef4444;
  --border:#d1d5db; --field:#ffffff;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--ink);
  font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,"PingFang SC","Noto Sans CJK SC","Helvetica Neue",Arial}
a{color:var(--brand);text-decoration:none}
.wrap{max-width:1100px;margin:0 auto;padding:12px 14px 120px}
.header{
  position:sticky;top:0;z-index:10;background:linear-gradient(#91C6FF, #91C6FFcc 80%, transparent);
  padding:10px 0 4px
}
.titlebar{display:flex;gap:10px;align-items:center;justify-content:space-between}
.appTitle{font-weight:800;font-size:20px}
.tabs{display:flex;gap:8px;flex-wrap:wrap;margin-top:8px}
.tab{background:#fff;border:1px solid var(--border);border-radius:999px;padding:8px 12px;cursor:pointer}
.tab.active{background:var(--brand);color:#fff;border-color:var(--brand)}
.card{background:#fff;border:1px solid var(--border);border-radius:16px;padding:16px;margin:12px 0;box-shadow:0 6px 20px rgba(0,0,0,.06)}
.sectionTitle{font-size:16px;font-weight:700;margin:0 0 10px}
.row{display:grid;gap:16px}
.auto{grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
.controls{grid-template-columns:repeat(auto-fit,minmax(260px,1fr))}
select,input[type="text"],input[type="number"],input[type="color"],textarea{
  width:100%;background:var(--field);color:var(--ink);border:1px solid var(--border);
  border-radius:10px;padding:10px 12px;font-size:14px;outline:none
}
textarea{min-height:160px;resize:vertical}
.bigtext{min-height:280px;max-height:540px;overflow:auto}
.btn{border:none;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer;font-size:14px}
.btn.brand{background:var(--brand);color:#fff}
.btn.ok{background:var(--ok);color:#fff}
.btn.warn{background:var(--warn);color:#fff}
.btn.ghost{background:transparent;border:1px solid var(--border);color:var(--ink)}
.btn.danger{background:var(--danger);color:#fff}
.btn.xs{padding:6px 10px;font-size:12px}
.center{display:flex;justify-content:center;align-items:center}
.muted{color:var(--muted)} .tiny{font-size:12px}
.hide{display:none}
.toast{position:fixed;left:50%;bottom:24px;transform:translateX(-50%);background:#111827;color:#e5e7eb;border:1px solid #334155;
  padding:10px 14px;border-radius:12px;box-shadow:0 6px 24px rgba(0,0,0,.35);z-index:9999;opacity:0;transition:opacity .2s}
hr.sep{border:none;border-top:1px dashed var(--border);margin:8px 0}
.grid2{display:grid;grid-template-columns:1fr auto;gap:12px;align-items:end}

/* 首页单选卡片 */
.choices{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px}
.choice{display:flex;align-items:center;gap:8px;background:#fff;border:2px solid var(--border);border-radius:14px;padding:10px;cursor:pointer}
.choice input{transform:scale(1.2)}

/* 训练页分页 */
.subtabs{display:flex;gap:8px;flex-wrap:wrap;margin:8px 0 2px}
.subtab{background:#fff;border:1px solid var(--border);border-radius:999px;padding:6px 12px;cursor:pointer}
.subtab.active{background:var(--brand);color:#fff;border-color:var(--brand)}

/* 视频列表 + 播放区 */
.video-list{display:flex;flex-direction:column;gap:8px;max-height:360px;overflow:auto}
.video-item{display:flex;gap:8px;align-items:center;background:#f8fafc;border:1px solid var(--border);border-radius:10px;padding:8px}
.vi-name{flex:1 1 auto;background:transparent;border:none;color:var(--ink);padding:6px 8px;border-radius:8px}
.embed{width:100%;min-height:480px;aspect-ratio:16/9;border:1px solid var(--border);border-radius:12px;overflow:hidden;background:#000}
iframe{width:100%;height:100%;border:0}

/* 计时显示（训练页） */
.timer{font-size:40px;font-weight:800;letter-spacing:1px}
</style>
</head>
<body>
<div class="wrap">
  <!-- 顶部导航 -->
  <div class="header">
    <div class="titlebar">
      <div class="appTitle" id="appTitle">训练提醒 v3.12</div>
      <div class="tabs">
        <div class="tab active" data-page="home">🏠 首页</div>
        <div class="tab" data-page="work">🏋️ 训练</div>
        <div class="tab" data-page="settings">⚙️ 设置</div>
      </div>
    </div>
  </div>

  <!-- 首页 -->
  <div id="page-home">
    <div class="card">
      <div class="sectionTitle">今天训练什么？</div>
      <div class="choices">
        <label class="choice"><input type="radio" name="part" value="legs">腿</label>
        <label class="choice"><input type="radio" name="part" value="chest">胸</label>
        <label class="choice"><input type="radio" name="part" value="back">背</label>
        <label class="choice"><input type="radio" name="part" value="shoulders">肩</label>
        <label class="choice"><input type="radio" name="part" value="core">核心</label>
        <label class="choice"><input type="radio" name="part" value="custom">自定义</label>
      </div>
      <div class="row auto" style="margin-top:12px">
        <div class="field"><label>自定义部位名称</label><input id="customName" type="text" placeholder="如：全身循环 / 技术练习"></div>
        <button class="btn brand" id="btnStart">进入训练页</button>
      </div>
    </div>
  </div>

  <!-- 训练页 -->
  <div id="page-work" class="hide">
    <div class="card">
      <div class="sectionTitle"><span id="workTitle">训练</span> · 控制台</div>
      <div class="row controls">
        <div class="field">
          <label>当前部位</label>
          <select id="workPart">
            <option value="legs">腿</option><option value="chest">胸</option>
            <option value="back">背</option><option value="shoulders">肩</option>
            <option value="core">核心</option><option value="custom">自定义</option>
          </select>
        </div>
        <div class="field">
          <label>休息间隔（秒）</label>
          <input id="interval" type="number" min="10" step="5"/>
        </div>
        <div class="field">
          <label>响铃时长（秒）</label>
          <input id="beepLen" type="number" min="1" max="10"/>
          <div class="tiny muted">铃声文件：/bell.mp3 或 /bell.mp4</div>
        </div>
      </div>

      <div class="grid2" style="margin-top:10px">
        <div>
          <div class="muted tiny">倒计时</div>
          <div class="timer"><span id="count">60</span>s</div>
        </div>
        <div class="row auto" style="max-width:420px">
          <button class="btn brand" id="start">▶️ 开始</button>
          <button class="btn danger" id="stop">⏹ 停止</button>
          <button class="btn ghost" id="ping">🔔 试铃</button>
        </div>
      </div>
    </div>

    <div class="subtabs">
      <div class="subtab active" data-sub="last">① 上次记录</div>
      <div class="subtab" data-sub="now">② 本次计划</div>
      <div class="subtab" data-sub="video">③ 视频参考</div>
      <div class="subtab" data-sub="next">④ 下次展望</div>
    </div>

    <!-- 上次 -->
    <div id="sub-last">
      <div class="card">
        <div class="sectionTitle">上次训练计划 & 感受（只读）</div>
        <textarea id="planLast" class="bigtext" readonly></textarea>
        <div class="row auto" style="margin-top:8px">
          <button class="btn ghost" id="copyToNow">⬅️ 复制为本次计划</button>
          <button class="btn warn" id="clearLast">🧹 清空上次</button>
        </div>
      </div>
    </div>

    <!-- 本次 -->
    <div id="sub-now" class="hide">
      <div class="card">
        <div class="sectionTitle">本次训练预计计划 & 重量建议</div>
        <textarea id="planNow" class="bigtext" placeholder="在这里写今天要做的内容、目标组次/次数、重量区间…"></textarea>
        <div class="row auto" style="margin-top:8px">
          <button class="btn ok" id="saveNow">💾 保存本次</button>
          <button class="btn brand" id="saveToLast">✅ 本次完成 → 存为“上次”</button>
        </div>
      </div>
      <div class="card">
        <div class="sectionTitle">动作注意事项（会随部位分别保存）</div>
        <textarea id="notes" class="bigtext" placeholder="要点/呼吸/落点/节奏/注意危险信号…"></textarea>
        <div class="tiny muted">自动保存</div>
      </div>
    </div>

    <!-- 视频 -->
    <div id="sub-video" class="hide">
      <div class="card">
        <div class="sectionTitle">训练视频参考（按部位保存）</div>
        <div class="row auto">
          <div class="field">
            <label>粘贴链接（YouTube/B站）</label>
            <input id="vUrl" type="text" placeholder="https://...">
          </div>
          <div class="field">
            <label>自定义标题</label>
            <input id="vName" type="text" placeholder="如：腿日热身-髋膝踝激活">
          </div>
          <button class="btn ok" id="addVideo">添加</button>
        </div>
        <div id="vList" class="video-list" style="margin-top:10px"></div>
      </div>

      <div class="card">
        <div class="sectionTitle">播放区（可全屏）</div>
        <div class="embed" id="embedBox"><div class="muted tiny" style="padding:10px">未选择视频</div></div>
        <div class="row auto" style="margin-top:8px">
          <button class="btn ghost" id="enterFs">⛶ 全屏</button>
        </div>
      </div>
    </div>

    <!-- 下次 -->
    <div id="sub-next" class="hide">
      <div class="card">
        <div class="sectionTitle">下一次训练日的展望计划</div>
        <textarea id="planNext" class="bigtext" placeholder="写下次要提升的重量、动作顺序调整、容量/强度策略…"></textarea>
        <div class="row auto" style="margin-top:8px">
          <button class="btn ok" id="saveNext">💾 保存</button>
          <button class="btn warn" id="clearNext">🧹 清空</button>
        </div>
      </div>
    </div>
  </div>

  <!-- 设置页 -->
  <div id="page-settings" class="hide">
    <div class="card">
      <div class="sectionTitle">外观 / 标识</div>
      <div class="row auto">
        <div class="field"><label>自定义标题</label><input id="titleInput" type="text" placeholder="如：Jasper 训练计划"></div>
        <div class="field"><label>自定义版本号</label><input id="verInput" type="text" placeholder="如：v3.12"></div>
        <div class="field"><label>背景颜色</label><input id="bgColor" type="color" value="#91C6FF"></div>
        <button class="btn ok" id="saveBrand">💾 保存标题/版本/背景</button>
      </div>
    </div>

    <div class="card">
      <div class="sectionTitle">计时 / 铃声</div>
      <div class="row auto">
        <div class="field"><label>休息间隔（秒）</label><input id="setInterval" type="number" min="10" step="5"></div>
        <div class="field"><label>响铃时长（秒）</label><input id="setBeepLen" type="number" min="1" max="10"></div>
        <button class="btn ghost" id="testBell">🔔 试放铃声</button>
      </div>
    </div>

    <div class="card">
      <div class="sectionTitle">背景音乐</div>
      <div class="row auto">
        <div class="field">
          <label>音乐列表（读取 /music/list.json 或从本地文件夹）</label>
          <select id="musicSelect"></select>
          <div class="tiny muted" id="musicHint">优先读取 /music/list.json；没有就点击“从本地文件夹读取”</div>
        </div>
        <div class="field">
          <label>操作</label>
          <div class="row auto">
            <button class="btn ok" id="bgmPlay">▶️ 播放</button>
            <button class="btn danger" id="bgmPause">⏸ 暂停</button>
            <button class="btn ghost" id="readFolder">📂 从本地文件夹读取</button>
          </div>
        </div>
        <div class="field">
          <label>音量</label>
          <div class="row auto">
            <input type="range" id="bgmVol" min="0" max="1" step="0.01" value="0.5">
            <div class="tiny muted" id="bgmVolTxt">0.50</div>
          </div>
        </div>
      </div>
      <video id="bgmMedia" preload="auto" loop style="display:none"></video>
    </div>
  </div>
</div>

<!-- 音频 -->
<audio id="beepAudio" preload="auto"></audio>
<div id="toast" class="toast"></div>

<script>
(()=>{
// ====== 工具 ======
const $=id=>document.getElementById(id);
const show=(id)=>$(id).classList.remove('hide');
const hide=(id)=>$(id).classList.add('hide');
const toast=(m)=>{const t=$("toast");t.textContent=m;t.style.opacity=0;t.style.display='block';requestAnimationFrame(()=>t.style.opacity=1);setTimeout(()=>{t.style.opacity=0;setTimeout(()=>t.style.display='none',200)},1600);}
const load=(k,f)=>{try{return JSON.parse(localStorage.getItem(k))??f}catch{return f}};
const save=(k,v)=>localStorage.setItem(k,JSON.stringify(v));
const K={
  prefs:'pg_prefs_v1',
  plansNow:'pg_now_v1', plansLast:'pg_last_v1',
  notes:'pg_notes_v1', planNext:'pg_next_v1',
  videos:'pg_videos_v1', brand:'pg_brand_v1',
  music:'pg_music_v1'
};
// ====== 状态与默认 ======
let brand=load(K.brand,{title:'训练提醒',ver:'v3.12',bg:'#91C6FF'});
let prefs=load(K.prefs,{interval:60,beepLen:2,part:'legs',customName:''});
let plansNow=load(K.plansNow,{legs:'',chest:'',back:'',shoulders:'',core:'',custom:''});
let plansLast=load(K.plansLast,{legs:'',chest:'',back:'',shoulders:'',core:'',custom:''});
let notes=load(K.notes,{legs:'',chest:'',back:'',shoulders:'',core:'',custom:''});
let planNext=load(K.planNext,{legs:'',chest:'',back:'',shoulders:'',core:'',custom:''});
let videos=load(K.videos,{legs:[],chest:[],back:[],shoulders:[],core:[],custom:[]});
let musicList=load(K.music,[]);

document.body.style.backgroundColor=brand.bg;
$("appTitle").textContent=`${brand.title} ${brand.ver}`;
$("titleInput").value=brand.title; $("verInput").value=brand.ver; $("bgColor").value=brand.bg;

function setActiveTab(name){
  document.querySelectorAll('.tab').forEach(t=>t.classList.toggle('active',t.dataset.page===name));
  ['page-home','page-work','page-settings'].forEach(id=>hide(id));
  show(`page-${name}`);
}
document.querySelectorAll('.tab').forEach(t=>t.onclick=()=>setActiveTab(t.dataset.page));

// 首页选择
document.querySelectorAll('input[name="part"]').forEach(r=>{
  r.checked = (r.value===prefs.part);
  r.onchange=()=>{prefs.part=r.value; save(K.prefs,prefs);}
});
$("customName").value=prefs.customName;
$("customName").oninput=()=>{prefs.customName=$("customName").value.trim(); save(K.prefs,prefs);};

$("btnStart").onclick=()=>{
  setActiveTab('work');
  $("workPart").value=prefs.part;
  $("workTitle").textContent=(prefs.part==='custom'?(prefs.customName||'自定义'):{"legs":"腿","chest":"胸","back":"背","shoulders":"肩","core":"核心"}[prefs.part])+' · 控制台';
  $("interval").value=prefs.interval; $("beepLen").value=prefs.beepLen;
  loadPartState();
};

// 训练页：部位切换
$("workPart").onchange=()=>{prefs.part=$("workPart").value; save(K.prefs,prefs); loadPartState();};
function loadPartState(){
  $("planNow").value=plansNow[prefs.part]||'';
  $("planLast").value=plansLast[prefs.part]||'';
  $("notes").value=notes[prefs.part]||'';
  $("planNext").value=planNext[prefs.part]||'';
  renderVideo();
}

// 训练页：子分页
function setSub(name){
  document.querySelectorAll('.subtab').forEach(s=>s.classList.toggle('active',s.dataset.sub===name));
  ['sub-last','sub-now','sub-video','sub-next'].forEach(id=>hide(id));
  show(`sub-${name}`);
}
document.querySelectorAll('.subtab').forEach(s=>s.onclick=()=>setSub(s.dataset.sub));

// 训练页：文本保存
$("saveNow").onclick=()=>{plansNow[prefs.part]=$("planNow").value.trim(); save(K.plansNow,plansNow); toast('已保存本次');};
$("saveToLast").onclick=()=>{plansLast[prefs.part]=$("planNow").value.trim(); save(K.plansLast,plansLast); $("planLast").value=plansLast[prefs.part]; toast('已保存为上次');};
$("copyToNow").onclick=()=>{$("planNow").value=$("planLast").value; $("saveNow").click();};
$("clearLast").onclick=()=>{ if(!confirm('清空上次记录？'))return; plansLast[prefs.part]=''; save(K.plansLast,plansLast); $("planLast").value=''; };
$("saveNext").onclick=()=>{planNext[prefs.part]=$("planNext").value.trim(); save(K.planNext,planNext); toast('已保存');};
$("clearNext").onclick=()=>{ if(!confirm('清空下一次展望？'))return; planNext[prefs.part]=''; save(K.planNext,planNext); $("planNext").value='';};
$("notes").oninput=()=>{clearTimeout(window.__noteDeb); window.__noteDeb=setTimeout(()=>{notes[prefs.part]=$("notes").value.trim(); save(K.notes,notes);},500);};

// 计时/铃声
$("interval").onchange=()=>{prefs.interval=Math.max(10,+$("interval").value||60); save(K.prefs,prefs); $("count").textContent=prefs.interval;}
$("beepLen").onchange=()=>{prefs.beepLen=Math.min(10,Math.max(1,+$("beepLen").value||2)); save(K.prefs,prefs);}
const beep=$("beepAudio");
(async()=>{try{const r=await fetch('bell.mp3',{method:'HEAD'}); if(r.ok){beep.src='bell.mp3';return;}}catch{} try{const r2=await fetch('bell.mp4',{method:'HEAD'}); if(r2.ok){beep.src='bell.mp4';}}catch{} })();
let audioCtx=null; function ensureCtx(){ if(!audioCtx){const AC=window.AudioContext||window.webkitAudioContext; if(AC) audioCtx=new AC();}}
function synthBeep(sec){try{ensureCtx(); if(!audioCtx) return; const o=audioCtx.createOscillator(),g=audioCtx.createGain(); o.type='sine';o.frequency.value=880;o.connect(g);g.connect(audioCtx.destination); g.gain.value=.2;o.start();setTimeout(()=>o.stop(),(sec||2)*1000);}catch{}}
function userUnlock(){try{ensureCtx(); if(audioCtx && audioCtx.state==='suspended') audioCtx.resume(); beep.play().then(()=>beep.pause()).catch(()=>{});}catch{}}
['click','touchstart'].forEach(e=>document.addEventListener(e,userUnlock,{once:true}));
function playBeep(){ if(beep.src){ try{beep.currentTime=0; beep.play().catch(()=>{});}catch{ synthBeep(prefs.beepLen);} } else synthBeep(prefs.beepLen); }
$("ping").onclick=playBeep;

let timer=null,endAt=0;
function scheduleNext(){endAt=Date.now()+ (prefs.interval*1000);}
function updateTimer(){const remain=Math.max(0,Math.ceil((endAt-Date.now())/1000)); $("count").textContent=remain; if(remain<=0){playBeep(); scheduleNext();}}
$("start").onclick=()=>{ if(timer) return; scheduleNext(); updateTimer(); timer=setInterval(updateTimer,500); toast('计时开始'); };
$("stop").onclick=()=>{ if(!timer) return; clearInterval(timer); timer=null; $("count").textContent=prefs.interval; toast('已停止'); };
document.addEventListener('visibilitychange',()=>{ if(timer) updateTimer(); });

// 视频
function parseEmbed(url){
  try{
    if(/youtube\.com\/watch\?v=|youtu\.be\//.test(url)){ const id=url.match(/v=([^&]+)/)?.[1]||url.split('/').pop(); return `https://www.youtube.com/embed/${id}`;}
    if(/bilibili\.com\/video\/BV/i.test(url)){const bv=url.match(/\/BV[0-9A-Za-z]+/i)[0].replace('/',''); return `https://player.bilibili.com/player.html?${bv}&autoplay=1`; }
    return url;
  }catch{return url;}
}
function renderVideo(){
  const host=$("vList"); host.innerHTML='';
  videos[prefs.part].forEach((it,i)=>{
    const row=document.createElement('div'); row.className='video-item';
    const name=document.createElement('input'); name.className='vi-name'; name.value=it.name; name.onchange=()=>{it.name=name.value.trim()||'未命名'; save(K.videos,videos);}
    const play=document.createElement('button'); play.className='btn ok xs'; play.textContent='播放'; play.onclick=()=>{$("embedBox").innerHTML=`<iframe src="${parseEmbed(it.url)}" allowfullscreen allow="autoplay; encrypted-media"></iframe>`;}
    const open=document.createElement('a'); open.className='btn ghost xs'; open.textContent='打开'; open.href=it.url; open.target='_blank';
    const del=document.createElement('button'); del.className='btn danger xs'; del.textContent='删除'; del.onclick=()=>{videos[prefs.part].splice(i,1); save(K.videos,videos); renderVideo();}
    row.append(name,play,open,del); host.appendChild(row);
  });
}
$("addVideo").onclick=()=>{ const u=$("vUrl").value.trim(); const n=($("vName").value.trim()||'未命名'); if(!u) return; videos[prefs.part].push({name:n,url:u}); save(K.videos,videos); $("vUrl").value=""; $("vName").value=""; renderVideo();};
$("enterFs").onclick=()=>{ const box=$("embedBox"); if(box.requestFullscreen) box.requestFullscreen(); else if(box.webkitRequestFullscreen) box.webkitRequestFullscreen(); };

// 设置：标题/版本/背景
$("saveBrand").onclick=()=>{ brand.title=$("titleInput").value.trim()||'训练提醒'; brand.ver=$("verInput").value.trim()||''; brand.bg=$("bgColor").value||'#91C6FF'; save(K.brand,brand); $("appTitle").textContent=`${brand.title} ${brand.ver}`; document.body.style.backgroundColor=brand.bg; toast('已保存外观'); };

// 设置：计时
$("setInterval").value=prefs.interval; $("setBeepLen").value=prefs.beepLen;
$("setInterval").onchange=()=>{prefs.interval=Math.max(10,+$("setInterval").value||60); save(K.prefs,prefs); $("interval").value=prefs.interval; $("count").textContent=prefs.interval;};
$("setBeepLen").onchange=()=>{prefs.beepLen=Math.min(10,Math.max(1,+$("setBeepLen").value||2)); save(K.prefs,prefs); $("beepLen").value=prefs.beepLen;};
$("testBell").onclick=playBeep;

// 设置：音乐
const musicSel=$("musicSelect"), vbgm=$("bgmMedia");
async function tryLoadServerList(){
  try{ const r=await fetch('music/list.json',{cache:'no-store'}); if(!r.ok) return false;
       const arr=await r.json(); if(!Array.isArray(arr)) return false; musicList=arr.map(n=>`music/${n}`); save(K.music,musicList); return true;
  }catch{return false;}
}
function renderMusic(){ musicSel.innerHTML=''; if(!musicList.length){const o=document.createElement('option');o.value='';o.textContent='（暂无音乐）';musicSel.appendChild(o);return;} musicList.forEach(p=>{const o=document.createElement('option');o.value=p;o.textContent=p.split('/').pop();musicSel.appendChild(o);});}
(async()=>{ const ok=await tryLoadServerList(); renderMusic(); $("musicHint").textContent= ok?'已读取 /music/list.json':'未找到 /music/list.json，可用“从本地文件夹读取”（本机会话）'; })();
$("bgmPlay").onclick=()=>{ const src=musicSel.value; if(!src) return toast('没有可播放的音乐'); vbgm.src=src; vbgm.volume=+$("bgmVol").value; vbgm.play().catch(()=>toast('先点一下页面解锁音频')); };
$("bgmPause").onclick=()=>{ try{vbgm.pause()}catch{} };
$("bgmVol").oninput=()=>{ vbgm.volume=+$("bgmVol").value; $("bgmVolTxt").textContent=(+$("bgmVol").value).toFixed(2); };
$("readFolder").onclick=()=>{ const inp=document.createElement('input'); inp.type='file'; inp.webkitdirectory=true; inp.multiple=true; inp.accept='audio/*,video/*';
  inp.onchange=()=>{ const files=[...inp.files].filter(f=>/\.(mp3|m4a|wav|mp4|ogg)$/i.test(f.name)); musicList=files.map(f=>URL.createObjectURL(f)); save(K.music,musicList); renderMusic(); toast('已从本地文件夹生成列表（刷新后失效）'); }; inp.click(); };

// 默认：展示首页
setActiveTab('home'); setSub('last');
})();
</script>
</body>
</html>
