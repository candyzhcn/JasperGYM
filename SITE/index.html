<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<meta name="theme-color" content="#91C6FF"/>
<title>è®­ç»ƒæé†’ Â· å…¨é‡ç‰ˆ</title>
<style>
:root{
  --bg:#91C6FF; --panel:#ffffff; --ink:#111; --muted:#5b616a;
  --brand:#2563eb; --ok:#10b981; --warn:#f59e0b; --danger:#ef4444;
  --border:#d1d5db; --field:#ffffff;
}
*{box-sizing:border-box}
html,body{height:100%}
body{margin:0;background:var(--bg);color:var(--ink);
  font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,"PingFang SC","Noto Sans CJK SC","Helvetica Neue",Arial}
a{color:var(--brand);text-decoration:none}
.wrap{max-width:1100px;margin:0 auto;padding:16px 16px 120px}
.header{position:static;top:0;z-index:10;background:linear-gradient(#91C6FF,#91C6FFcc 80%,transparent);padding:8px 0 6px}
.titlebar{display:flex;gap:10px;align-items:center;justify-content:space-between}
.appTitle{font-weight:800;font-size:20px}
.tabs{display:flex;gap:8px;flex-wrap:wrap}
.tab{background:#fff;border:1px solid var(--border);border-radius:999px;padding:8px 12px;cursor:pointer}
.tab.active{background:var(--brand);color:#fff;border-color:var(--brand)}
.card{background:#fff;border:1px solid var(--border);border-radius:16px;padding:16px;margin:12px 0;box-shadow:0 6px 20px rgba(0,0,0,.06)}
.sectionTitle{font-size:16px;font-weight:700;margin:0 0 10px}
.row{display:grid;gap:16px}
.auto{grid-template-columns:repeat(auto-fit,minmax(220px,1fr))}
select,input[type="text"],input[type="number"],input[type="color"],textarea{
  width:100%;background:var(--field);color:var(--ink);border:1px solid var(--border);
  border-radius:10px;padding:10px 12px;font-size:14px;outline:none
}
textarea{min-height:160px;resize:vertical}
.log-editor .bigtext{min-height:320px}
.bigtext{min-height:560px;max-height:860px;overflow:auto}
.btn{border:none;border-radius:10px;padding:10px 14px;font-weight:700;cursor:pointer;font-size:14px}
.btn.brand{background:var(--brand);color:#fff}
.btn.ok{background:var(--ok);color:#fff}
.btn.warn{background:var(--warn);color:#fff}
.btn.ghost{background:transparent;border:1px solid var(--border);color:#fff;background:#334155}
.btn.light{background:transparent;border:1px solid var(--border);color:#111}
.btn.danger{background:var(--danger);color:#fff}
.btn.xs{padding:6px 10px;font-size:12px}
.center{display:flex;justify-content:center;align-items:center}
.muted{color:var(--muted)} .tiny{font-size:12px}
.hide{display:none}
.toast{position:fixed;left:50%;bottom:24px;transform:translateX(-50%);background:#111827;color:#e5e7eb;border:1px solid #334155;
  padding:10px 14px;border-radius:12px;box-shadow:0 6px 24px rgba(0,0,0,.35);z-index:9999;opacity:0;transition:opacity .2s}
.grid2{display:grid;grid-template-columns:1fr auto;gap:12px;align-items:end}

/* é¦–é¡µé€‰æ‹© */
.choices{display:grid;grid-template-columns:repeat(auto-fit,minmax(140px,1fr));gap:12px}
.choice{display:flex;align-items:center;gap:8px;background:#fff;border:2px solid var(--border);border-radius:12px;padding:12px;cursor:pointer}
.choice input{transform:scale(1.2)}
.choice:hover{border-color:var(--brand)}
.choice .name{font-weight:700}

/* è®­ç»ƒé¡µ */
.timer{font-size:40px;font-weight:800;letter-spacing:1px}

/* æ—¥å¿—åˆ—è¡¨ */
.log-item{padding:10px 8px;border-bottom:1px solid var(--border);border-radius:8px}
.log-item:hover{background:#f8fafc}
.log-title{font-weight:600}
.log-content{margin-top:6px;white-space:pre-wrap}
.log-tools{display:flex;gap:6px;margin-top:6px}
</style>
</head>
<body>
<div class="wrap">
  <!-- é¡¶éƒ¨ -->
  <div class="header">
    <div class="titlebar">
      <div class="appTitle" id="appTitle">è®­ç»ƒæé†’ v3.22</div>
      <div class="tabs">
        <div class="tab active" data-page="home">ğŸ  é¦–é¡µ</div>
        <div class="tab" data-page="work">ğŸ‹ï¸ è®­ç»ƒ</div>
        <div class="tab" data-page="logs">ğŸ““ æ—¥å¿—</div>
        <div class="tab" data-page="settings">âš™ï¸ è®¾ç½®</div>
      </div>
    </div>
  </div>

  <!-- é¦–é¡µ -->
  <div id="page-home">
    <div class="card">
      <div class="sectionTitle">ä»Šå¤©è®­ç»ƒä»€ä¹ˆï¼Ÿ</div>
      <div class="choices" id="homeChoices"></div>
      <div class="grid2" style="margin-top:10px">
        <div class="tiny muted">é€‰æ‹©åç‚¹å‡»å¼€å§‹ï¼›å¯åœ¨è®¾ç½®é‡Œè‡ªå®šä¹‰é¢œè‰²/æ ‡é¢˜/èƒŒæ™¯éŸ³ä¹ã€‚</div>
        <button class="btn brand" id="btnStart">è¿›å…¥è®­ç»ƒé¡µ</button>
      </div>
    </div>
  </div>

  <!-- è®­ç»ƒé¡µ -->
  <div id="page-work" class="hide">
    <div class="card">
      <div class="sectionTitle">æœ¬æ¬¡è®­ç»ƒ</div>
      <div class="row auto">
        <div class="field"><label>è®­ç»ƒéƒ¨ä½</label>
          <select id="workPart"></select>
        </div>
        <div class="field"><label>æ—¶é—´é—´éš”ï¼ˆç§’ï¼‰</label>
          <input id="intervalInput" type="number" min="10" max="999" step="1" value="60"/>
        </div>
        <div class="field"><label>æç¤ºéŸ³é•¿åº¦ï¼ˆç§’ï¼‰</label>
          <input id="beepLen" type="number" min="1" max="10" step="1" value="2"/>
        </div>
      </div>
      <div class="center" style="margin:16px 0"><div class="timer" id="timer">00:00</div></div>
      <div class="row auto">
        <button class="btn ok" id="btnStartTimer">å¼€å§‹</button>
        <button class="btn light" id="btnStopTimer">åœæ­¢</button>
        <button class="btn light" id="btnDone">âœ… æœ¬æ¬¡å®Œæˆ â†’ åŠ å…¥æ—¥å¿—</button>
      </div>
    </div>
    <div class="card">
      <div class="sectionTitle">å‚è€ƒè§†é¢‘</div>
      <div class="row auto">
        <div class="field"><label>é€‰æ‹©è§†é¢‘</label><select id="videoSelect"></select></div>
        <a id="openVideo" class="btn light" target="_blank" href="#">æ‰“å¼€è§†é¢‘</a>
      </div>
    </div>
  </div>

  <!-- æ—¥å¿—é¡µ -->
  <div id="page-logs" class="hide">
    <div class="card">
      <div class="sectionTitle">è®­ç»ƒæ—¥å¿—ï¼ˆé»˜è®¤éšè—æ’åºæŒ‰é’®ï¼›é•¿æŒ‰å¯åˆ é™¤ï¼›å¼€å¯â€œæ’åºæ¨¡å¼â€åå¯ä¸Šä¸‹ç§»åŠ¨/åˆ é™¤ï¼‰</div>
      <div id="logList"></div>
      <div class="row auto" style="margin-top:10px">
        <button class="btn ok" id="toggleAddLog">â• æ·»åŠ æ—¥å¿—</button>
        <button class="btn ghost" id="toggleSort">ğŸ§­ æ’åºæ¨¡å¼ï¼šå…³</button>
      </div>
      <div id="addLogBox" class="hide" style="margin-top:10px">
        <textarea id="addLogText" class="bigtext" placeholder="æŠŠä½ çš„è®­ç»ƒæ€»ç»“ç²˜è´´åˆ°è¿™é‡Œï¼Œç¬¬ä¸€è¡Œå°†ä½œä¸ºæ ‡é¢˜"></textarea>
        <div class="row auto" style="margin-top:8px">
          <button class="btn ok" id="addLogSave">ä¿å­˜åˆ°æ—¥å¿—</button>
          <button class="btn light" id="addLogCancel">å–æ¶ˆ</button>
        </div>
      </div>
    </div>
  </div>

  <!-- è®¾ç½®é¡µï¼ˆç²¾ç®€ç¤ºæ„ï¼šä¿ç•™ä½ åŸæœ‰çš„å¯¼å…¥/å¯¼å‡º/æ¸…ç©ºç­‰ï¼‰ -->
  <div id="page-settings" class="hide">
    <div class="card">
      <div class="sectionTitle">å¤–è§‚ / æ ‡è¯†</div>
      <div class="row auto">
        <div class="field"><label>è‡ªå®šä¹‰æ ‡é¢˜</label><input id="titleInput" type="text" placeholder="å¦‚ï¼šJasper è®­ç»ƒè®¡åˆ’"></div>
        <div class="field"><label>è‡ªå®šä¹‰ç‰ˆæœ¬å·</label><input id="verInput" type="text" placeholder="å¦‚ï¼šv3.22"></div>
        <div class="field"><label>èƒŒæ™¯é¢œè‰²</label><input id="bgColor" type="color" value="#91C6FF"></div>
        <button class="btn ok" id="saveBrand">ä¿å­˜å¤–è§‚</button>
      </div>
    </div>

    <div class="card">
      <div class="sectionTitle">è§†é¢‘ç®¡ç†ï¼ˆæŒ‰éƒ¨ä½ä¿å­˜ï¼‰</div>
      <div class="row auto">
        <div class="field"><label>éƒ¨ä½</label><select id="vmPart"></select></div>
        <div class="field"><label>åç§°</label><input id="vmName" type="text" placeholder="å¦‚ï¼šæ·±è¹²åŠ¨ä½œè®²è§£"></div>
        <div class="field"><label>é“¾æ¥</label><input id="vmUrl" type="text" placeholder="https://..."></div>
        <button class="btn ok" id="vmAdd">æ·»åŠ /æ›´æ–°</button>
      </div>
      <div id="vmList" style="margin-top:10px"></div>
    </div>

    <div class="card">
      <div class="sectionTitle">æ•°æ®ç®¡ç†</div>
      <div class="row auto">
        <button class="btn ok" id="exportAll">ğŸ“¤ å¯¼å‡ºå…¨éƒ¨æ•°æ®</button>
        <input type="file" id="importFile" class="hide" accept=".json"/>
        <button class="btn warn" id="importAll">ğŸ“¥ å¯¼å…¥æ•°æ®ï¼ˆè¦†ç›–æœ¬åœ°ï¼‰</button>
        <button class="btn danger" id="wipeAll">ğŸ—‘ æ¸…ç©ºå…¨éƒ¨æ•°æ®ï¼ˆä¸å¯æ¢å¤ï¼‰</button>
      </div>
    </div>
  </div>
</div>

<div id="toast" class="toast hide"></div>

<script>
// ===== å·¥å…·å‡½æ•° =====
const $=id=>document.getElementById(id);
const show=id=>$(id).classList.remove('hide');
const hide=id=>$(id).classList.add('hide');
function toast(msg){const t=$('toast');t.textContent=msg;t.classList.remove('hide');t.style.opacity=1;setTimeout(()=>t.style.opacity=0,1600);setTimeout(()=>t.classList.add('hide'),1900);}

// ===== å­˜å‚¨é”® =====
const K={
  brand:'gym_brand',
  prefs:'gym_prefs',
  videos:'gym_videos',
  logs:'gym_logs'
};

// ===== åˆå§‹åŒ–æ•°æ®ï¼ˆç¤ºä¾‹/é»˜è®¤ï¼‰ =====
let brand=load(K.brand,{title:'è®­ç»ƒæé†’ Â· å…¨é‡ç‰ˆ',ver:'v3.22',bg:'#91C6FF'});
let prefs=load(K.prefs,{interval:60,beepLen:2,part:'legs'});
let videos=load(K.videos,{legs:[],chest:[],back:[],arms:[],shoulders:[],core:[]});
let logs=load(K.logs,[]);
let sortMode=false;

function load(key,def){try{const t=localStorage.getItem(key);return t?JSON.parse(t):def}catch(e){return def}}
function save(key,val){localStorage.setItem(key,JSON.stringify(val))}

// ===== é¡¶éƒ¨å¯¼èˆª =====
document.querySelectorAll('.tab').forEach(t=>{
  t.onclick=()=>{
    document.querySelectorAll('.tab').forEach(x=>x.classList.remove('active'));
    t.classList.add('active');
    ['home','work','logs','settings'].forEach(p=>$('page-'+p).classList.add('hide'));
    $('page-'+t.dataset.page).classList.remove('hide');
  };
});

// ===== é¦–é¡µï¼šéƒ¨ä½é€‰æ‹© =====
const parts=[
  {id:'legs',name:'è…¿éƒ¨'},{id:'chest',name:'èƒ¸éƒ¨'},{id:'back',name:'èƒŒéƒ¨'},
  {id:'arms',name:'æ‰‹è‡‚'},{id:'shoulders',name:'è‚©éƒ¨'},{id:'core',name:'æ ¸å¿ƒ'}
];
function renderHomeChoices(){
  const box=$('homeChoices'); box.innerHTML='';
  parts.forEach(p=>{
    const div=document.createElement('div'); div.className='choice';
    div.innerHTML=`<input type="radio" name="part" value="${p.id}"/><span class="name">${p.name}</span>`;
    div.onclick=()=>{prefs.part=p.id; save(K.prefs,prefs);};
    box.appendChild(div);
  });
}
$('btnStart').onclick=()=>{ setActive('work'); renderWork(); };

// ===== é¡µé¢åˆ‡æ¢ =====
function setActive(page){
  ['home','work','logs','settings'].forEach(p=>$('page-'+p).classList.add('hide'));
  $('page-'+page).classList.remove('hide');
  document.querySelectorAll('.tab').forEach(el=>el.classList.remove('active'));
  document.querySelector(`.tab[data-page="${page}"]`).classList.add('active');
}

// ===== è®­ç»ƒé¡µ =====
function renderWork(){
  const sel=$('workPart'); sel.innerHTML='';
  parts.forEach(p=>{ const o=document.createElement('option'); o.value=p.id; o.textContent=p.name; sel.appendChild(o);});
  sel.value=prefs.part;
  $('intervalInput').value=prefs.interval;
  $('beepLen').value=prefs.beepLen;

  // è§†é¢‘é€‰æ‹©
  const vs=$('videoSelect'); vs.innerHTML='';
  const arr=videos[prefs.part]||[];
  arr.forEach((it,idx)=>{ const o=document.createElement('option'); o.value=idx; o.textContent=it.name; vs.appendChild(o); });
  $('openVideo').onclick=()=>{ const i=vs.value; if(i===''||i==null){toast('è¯·é€‰æ‹©è§†é¢‘');return;} window.open(arr[i].url,'_blank'); };

  $('btnStartTimer').onclick=()=>startTimer();
  $('btnStopTimer').onclick=()=>stopTimer();
  $('btnDone').onclick=()=>{ appendLogFromText(`æœ¬æ¬¡è®­ç»ƒï¼š${parts.find(x=>x.id===prefs.part).name}\næ—¶é—´ï¼š${new Date().toLocaleString()}`); renderLogs(); toast('å·²åŠ å…¥æ—¥å¿—'); };
}
let timerId=null,elapsed=0;
function startTimer(){ stopTimer(); elapsed=0; tick(); timerId=setInterval(tick,1000); }
function stopTimer(){ if(timerId){clearInterval(timerId); timerId=null;} }
function tick(){ elapsed++; $('timer').textContent = new Date(elapsed*1000).toISOString().substr(14,5); }

// ===== æ—¥å¿—ï¼šæ¸²æŸ“ + æ·»åŠ  =====
function appendLogFromText(txt){
  const first=(txt.split(/\r?\n/)[0]||'').trim()||'ï¼ˆæ— æ ‡é¢˜ï¼‰';
  logs.push({title:first,content:txt,ts:Date.now()});
  save(K.logs,logs);
}
$('toggleAddLog').onclick=()=>{ const box=$('addLogBox'); box.classList.toggle('hide'); };
$('addLogCancel').onclick=()=>hide('addLogBox');
$('addLogSave').onclick=()=>{
  const txt=$('addLogText').value.trim();
  if(!txt) return toast('è¯·ç²˜è´´å®Œæ•´æ—¥å¿—');
  appendLogFromText(txt); $('addLogText').value=''; hide('addLogBox'); renderLogs(); toast('å·²æ·»åŠ åˆ°æ—¥å¿—');
};

$('toggleSort').onclick=()=>{
  sortMode=!sortMode;
  $('toggleSort').textContent=`ğŸ§­ æ’åºæ¨¡å¼ï¼š${sortMode?'å¼€':'å…³'}`;
  renderLogs();
};

function bindLongPress(el,fn){
  let t; el.addEventListener('touchstart',()=>{t=setTimeout(fn,600)},{passive:true});
  ['touchend','touchcancel','mouseup','mouseleave'].forEach(ev=>el.addEventListener(ev,()=>clearTimeout(t)));
}

function renderLogs(){
  const box=$('logList'); box.innerHTML='';
  if(!logs.length){box.innerHTML='<div class="tiny muted">æš‚æ— æ—¥å¿—ã€‚å®Œæˆè®­ç»ƒæ—¶ç‚¹â€œæœ¬æ¬¡å®Œæˆâ€ä¼šè‡ªåŠ¨è¿½åŠ ï¼›ä¹Ÿå¯ç‚¹å‡»â€œæ·»åŠ æ—¥å¿—â€ã€‚</div>';return;}
  logs.forEach((log,i)=>{
    const div=document.createElement('div');
    div.className='log-item';
    div.innerHTML=`<div class="log-title">${log.title}</div>`;
    const c=document.createElement('div'); c.className='log-content hide'; c.textContent=log.content||'ï¼ˆæ— å†…å®¹ï¼‰'; div.appendChild(c);

    if(sortMode){
      const tools=document.createElement('div'); tools.className='log-tools';
      tools.innerHTML=`
        <button class="btn xs light">â¬†ï¸ ä¸Šç§»</button>
        <button class="btn xs light">â¬‡ï¸ ä¸‹ç§»</button>
        <button class="btn xs light">âœï¸ ç¼–è¾‘</button>
        <button class="btn xs danger">ğŸ—‘ åˆ é™¤</button>`;
      const [upBtn,downBtn,editBtn,delBtn]=tools.querySelectorAll('button');
      editBtn.onclick=(e)=>{
        e.stopPropagation();
        // Inline editor in sort mode
        const editor=document.createElement('div'); editor.className='log-editor';
        const ta=document.createElement('textarea'); ta.className='bigtext'; ta.value=log.content||'';
        const row=document.createElement('div'); row.className='row auto'; row.style.marginTop='8px';
        const saveBtn=document.createElement('button'); saveBtn.className='btn ok'; saveBtn.textContent='ğŸ’¾ ä¿å­˜';
        const cancelBtn=document.createElement('button'); cancelBtn.className='btn light'; cancelBtn.textContent='å–æ¶ˆ';
        row.appendChild(saveBtn); row.appendChild(cancelBtn);
        editor.appendChild(ta); editor.appendChild(row);
        c.classList.add('hide');
        div.appendChild(editor);
        saveBtn.onclick=()=>{
          const newContent=ta.value;
          const firstLine=(newContent.split(/\r?\n/)[0]||'').trim() || log.title || 'ï¼ˆæ— æ ‡é¢˜ï¼‰';
          logs[i]={...logs[i], title:firstLine, content:newContent};
          save(K.logs,logs); renderLogs(); toast('å·²æ›´æ–°');
        };
        cancelBtn.onclick=()=>{ editor.remove(); c.classList.remove('hide'); };
      };
      upBtn.onclick=(e)=>{e.stopPropagation(); if(i>0){const t=logs[i-1];logs[i-1]=logs[i];logs[i]=t;save(K.logs,logs);renderLogs();}};
      downBtn.onclick=(e)=>{e.stopPropagation(); if(i<logs.length-1){const t=logs[i+1];logs[i+1]=logs[i];logs[i]=t;save(K.logs,logs);renderLogs();}};
      delBtn.onclick=(e)=>{e.stopPropagation(); if(confirm('åˆ é™¤è¿™æ¡æ—¥å¿—ï¼Ÿ')){logs.splice(i,1);save(K.logs,logs);renderLogs();}}
      div.appendChild(tools);
    }else{
      // éæ’åºæ¨¡å¼ï¼šå•å‡»å±•å¼€/æ”¶èµ·ï¼›åŒå‡» â†’ åŸä½å¤§æ–‡æœ¬æ¡†ç¼–è¾‘
      div.onclick=()=>c.classList.toggle('hide');
      div.ondblclick=()=>{
        // Inline editor for non-sort mode; title from first line
        const editor=document.createElement('div'); editor.className='log-editor';
        const ta=document.createElement('textarea'); ta.className='bigtext'; ta.value=log.content||'';
        const row=document.createElement('div'); row.className='row auto'; row.style.marginTop='8px';
        const saveBtn=document.createElement('button'); saveBtn.className='btn ok'; saveBtn.textContent='ğŸ’¾ ä¿å­˜';
        const cancelBtn=document.createElement('button'); cancelBtn.className='btn light'; cancelBtn.textContent='å–æ¶ˆ';
        row.appendChild(saveBtn); row.appendChild(cancelBtn);
        editor.appendChild(ta); editor.appendChild(row);
        c.classList.add('hide'); div.appendChild(editor);
        saveBtn.onclick=()=>{
          const newContent=ta.value;
          const firstLine=(newContent.split(/\r?\n/)[0]||'').trim() || log.title || 'ï¼ˆæ— æ ‡é¢˜ï¼‰';
          logs[i]={...logs[i], title:firstLine, content:newContent};
          save(K.logs,logs); renderLogs(); toast('å·²æ›´æ–°');
        };
        cancelBtn.onclick=()=>{ editor.remove(); c.classList.remove('hide'); };
      };
      bindLongPress(div,()=>{ if(confirm('é•¿æŒ‰ç¡®è®¤ï¼šåˆ é™¤è¿™æ¡æ—¥å¿—ï¼Ÿ')){logs.splice(i,1);save(K.logs,logs);renderLogs();}});
    }
    box.appendChild(div);
  });
}

// ===== è®¾ç½®ï¼šå¤–è§‚ / æ ‡è¯† =====
$('saveBrand').onclick=()=>{
  brand.title=$('titleInput').value||brand.title;
  brand.ver=$('verInput').value||brand.ver;
  brand.bg=$('bgColor').value||brand.bg;
  save(K.brand,brand);
  $('appTitle').textContent=`${brand.title} ${brand.ver}`;
  document.documentElement.style.setProperty('--bg', brand.bg);
  toast('å¤–è§‚å·²ä¿å­˜');
};

// ===== è®¾ç½®ï¼šè§†é¢‘ç®¡ç† =====
$('vmAdd').onclick=()=>{
  const part=$('vmPart').value||prefs.part;
  const name=$('vmName').value.trim();
  const url=$('vmUrl').value.trim();
  if(!name||!url) return toast('åç§°å’Œé“¾æ¥éƒ½è¦å¡«');
  const arr=videos[part]=videos[part]||[];
  const idx=arr.findIndex(x=>x.name===name);
  const item={name,url};
  if(idx>=0) arr[idx]=item; else arr.push(item);
  save(K.videos,videos); renderVmList(); toast('å·²ä¿å­˜');
};
function renderVmList(){
  $('vmPart').innerHTML=parts.map(p=>`<option value="${p.id}">${p.name}</option>`).join('');
  const box=$('vmList'); box.innerHTML='';
  const arr=videos[$('vmPart').value||prefs.part]||[];
  arr.forEach((it,idx)=>{
    const row=document.createElement('div'); row.className='vm-row';
    row.innerHTML=`<span class="vm-title" title="${it.name}">${it.name}</span>
      <div>
        <button class="btn xs light">âœï¸ ç¼–è¾‘</button>
        <button class="btn xs danger">ğŸ—‘ åˆ é™¤</button>
      </div>`;
    const [editBtn,delBtn]=row.querySelectorAll('button');
    editBtn.onclick=()=>{
      const newTitle=prompt('ä¿®æ”¹æ ‡é¢˜',it.name); if(newTitle===null) return;
      const newUrl=prompt('ä¿®æ”¹é“¾æ¥',it.url); if(newUrl===null) return;
      videos[$('vmPart').value][idx]={name:newTitle,url:newUrl};
      save(K.videos,videos); renderVmList(); toast('å·²æ›´æ–°');
    };
    delBtn.onclick=()=>{ if(confirm('åˆ é™¤è¿™ä¸ªè§†é¢‘ï¼Ÿ')){ arr.splice(idx,1); save(K.videos,videos); renderVmList(); toast('å·²åˆ é™¤'); } };
    box.appendChild(row);
  });
}

// ===== å¯¼å‡º / å¯¼å…¥ï¼ˆå…¨éƒ¨æ•°æ®ï¼‰ =====
$('exportAll').onclick=()=>{
  const payload={brand,prefs,videos,logs};
  const a=document.createElement('a');
  a.href='data:application/json;charset=utf-8,'+encodeURIComponent(JSON.stringify(payload,null,2));
  a.download='jaspergym-data.json'; a.click();
};
$('importAll').onclick=()=>$('importFile').click();
$('importFile').onchange=e=>{
  const f=e.target.files[0]; if(!f) return;
  const reader=new FileReader();
  reader.onload=()=>{
    try{
      const obj=JSON.parse(reader.result);
      if(obj.brand)brand=obj.brand;
      if(obj.prefs)prefs=obj.prefs;
      if(obj.videos)videos=obj.videos;
      if(obj.logs)logs=obj.logs;
      save(K.brand,brand); save(K.prefs,prefs); save(K.videos,videos); save(K.logs,logs);
      $('appTitle').textContent=`${brand.title} ${brand.ver}`;
      document.documentElement.style.setProperty('--bg', brand.bg);
      renderWork(); renderVmList(); renderLogs();
      toast('å¯¼å…¥å®Œæˆï¼ˆå·²è¦†ç›–æœ¬åœ°ï¼‰');
    }catch(err){ toast('å¯¼å…¥å¤±è´¥ï¼šJSON æœ‰è¯¯'); }
  };
  reader.readAsText(f,'utf-8');
};
$('wipeAll').onclick=()=>{
  if(!confirm('æ¸…ç©ºå…¨éƒ¨æœ¬åœ°æ•°æ®ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼')) return;
  Object.values(K).forEach(k=>localStorage.removeItem(k));
  toast('å·²æ¸…ç©ºæ•°æ®ï¼Œé¡µé¢å³å°†åˆ·æ–°â€¦'); setTimeout(()=>location.reload(),500);
};

// ===== å¯åŠ¨æ—¶æ¸²æŸ“ =====
(function init(){
  $('appTitle').textContent=`${brand.title} ${brand.ver}`;
  document.documentElement.style.setProperty('--bg', brand.bg);
  renderHomeChoices(); renderWork(); renderVmList(); renderLogs();
})();
</script>
</body>
</html>
