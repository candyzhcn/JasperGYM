<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>è®­ç»ƒæé†’ v3.21</title>
  <style>
    body{margin:0;font-family:sans-serif;background:var(--bg);color:var(--ink);}
    .header{position:relative;z-index:5;background:#fff;display:flex;gap:8px;padding:8px}
    .tab{padding:6px 12px;cursor:pointer;border:1px solid #ccc;border-radius:6px;user-select:none}
    .tab.active{background:#2563eb;color:#fff}
    .page{display:none;padding:12px}
    .page.active{display:block}
    .btn{padding:4px 10px;margin:2px;cursor:pointer;border-radius:4px;border:1px solid #ccc}
    .btn.ok{background:#10b981;color:#fff}
    .btn.light{background:#eee}
    .btn.danger{background:#ef4444;color:#fff}
    .row.auto{display:flex;gap:8px;flex-wrap:wrap}
    textarea{min-height:160px;resize:vertical;width:100%}
    .log-content{margin-top:6px;white-space:pre-wrap;word-break:break-word}
    .log-editor .bigtext{min-height:320px;width:100%}
  </style>
</head>
<body>
  <div class="header">
    <div class="tab active" data-page="home">ğŸ  é¦–é¡µ</div>
    <div class="tab" data-page="work">ğŸ‹ï¸ è®­ç»ƒ</div>
    <div class="tab" data-page="logs">ğŸ““ æ—¥å¿—</div>
    <div class="tab" data-page="settings">âš™ï¸ è®¾ç½®</div>
  </div>

  <div id="page-home" class="page active">è¿™é‡Œæ˜¯é¦–é¡µ</div>
  <div id="page-work" class="page">è¿™é‡Œæ˜¯è®­ç»ƒé¡µé¢</div>
  <div id="page-logs" class="page">
    <h2>æ—¥å¿—</h2>
    <div id="logList"></div>
    <div class="row auto" style="margin-top:10px">
      <button class="btn ok" id="toggleAddLog">â• æ·»åŠ æ—¥å¿—</button>
      <button class="btn light" id="toggleSort">ğŸ§­ æ’åºæ¨¡å¼ï¼šå…³</button>
    </div>
    <div class="card hide" id="addLogBox">
      <textarea id="addLogText" class="bigtext"></textarea>
      <button class="btn ok" id="addLogSave">ä¿å­˜</button>
    </div>
  </div>
  <div id="page-settings" class="page">è¿™é‡Œæ˜¯è®¾ç½®é¡µé¢</div>

  <script>
    // æ¨¡æ‹Ÿå­˜å‚¨
    let logs = JSON.parse(localStorage.getItem("logs")||"[]");
    function saveLogs(){ localStorage.setItem("logs",JSON.stringify(logs)); }

    // æ¸²æŸ“æ—¥å¿—
    function renderLogs(){
      const list=document.getElementById("logList");
      list.innerHTML="";
      logs.forEach((log,i)=>{
        const div=document.createElement("div");
        div.className="log-item";
        div.innerHTML=`<b>${log.title||"ï¼ˆæ— æ ‡é¢˜ï¼‰"}</b>`;
        const c=document.createElement("div");
        c.className="log-content";
        c.textContent=log.content||"ï¼ˆæ— å†…å®¹ï¼‰";
        div.appendChild(c);

        if(sortMode){
          const tools=document.createElement("div"); tools.className="log-tools";
          tools.innerHTML=`
            <button class="btn light">â¬†ï¸ ä¸Šç§»</button>
            <button class="btn light">â¬‡ï¸ ä¸‹ç§»</button>
            <button class="btn light">âœï¸ ç¼–è¾‘</button>
            <button class="btn danger">ğŸ—‘ åˆ é™¤</button>`;
          const [upBtn,downBtn,editBtn,delBtn]=tools.querySelectorAll("button");

          // ç¼–è¾‘ï¼šåŸä½å¤§è¾“å…¥æ¡†
          editBtn.onclick=(e)=>{
            e.stopPropagation();
            const editor=document.createElement("div"); editor.className="log-editor";
            const ta=document.createElement("textarea"); ta.className="bigtext"; ta.value=log.content||"";
            const row=document.createElement("div"); row.className="row auto"; row.style.marginTop="8px";
            const saveBtn=document.createElement("button"); saveBtn.className="btn ok"; saveBtn.textContent="ğŸ’¾ ä¿å­˜";
            const cancelBtn=document.createElement("button"); cancelBtn.className="btn light"; cancelBtn.textContent="å–æ¶ˆ";
            row.appendChild(saveBtn); row.appendChild(cancelBtn);
            editor.appendChild(ta); editor.appendChild(row);
            c.classList.add("hide"); div.appendChild(editor);

            saveBtn.onclick=()=>{
              const newContent=ta.value;
              const firstLine=(newContent.split(/\r?\n/)[0]||"").trim()||"ï¼ˆæ— æ ‡é¢˜ï¼‰";
              logs[i]={...logs[i], title:firstLine, content:newContent};
              saveLogs(); renderLogs();
            };
            cancelBtn.onclick=()=>{ editor.remove(); c.classList.remove("hide"); };
          };

          upBtn.onclick=()=>{ if(i>0){ [logs[i-1],logs[i]]=[logs[i],logs[i-1]]; saveLogs(); renderLogs(); } };
          downBtn.onclick=()=>{ if(i<logs.length-1){ [logs[i+1],logs[i]]=[logs[i],logs[i+1]]; saveLogs(); renderLogs(); } };
          delBtn.onclick=()=>{ if(confirm("åˆ é™¤ï¼Ÿ")){ logs.splice(i,1); saveLogs(); renderLogs(); } };
          div.appendChild(tools);
        }else{
          // éæ’åºæ¨¡å¼ï¼šåŒå‡»è¿›å…¥ç¼–è¾‘
          div.ondblclick=()=>{
            const editor=document.createElement("div"); editor.className="log-editor";
            const ta=document.createElement("textarea"); ta.className="bigtext"; ta.value=log.content||"";
            const row=document.createElement("div"); row.className="row auto"; row.style.marginTop="8px";
            const saveBtn=document.createElement("button"); saveBtn.className="btn ok"; saveBtn.textContent="ğŸ’¾ ä¿å­˜";
            const cancelBtn=document.createElement("button"); cancelBtn.className="btn light"; cancelBtn.textContent="å–æ¶ˆ";
            row.appendChild(saveBtn); row.appendChild(cancelBtn);
            editor.appendChild(ta); editor.appendChild(row);
            c.classList.add("hide"); div.appendChild(editor);

            saveBtn.onclick=()=>{
              const newContent=ta.value;
              const firstLine=(newContent.split(/\r?\n/)[0]||"").trim()||"ï¼ˆæ— æ ‡é¢˜ï¼‰";
              logs[i]={...logs[i], title:firstLine, content:newContent};
              saveLogs(); renderLogs();
            };
            cancelBtn.onclick=()=>{ editor.remove(); c.classList.remove("hide"); };
          };
        }
        list.appendChild(div);
      });
    }

    // æ·»åŠ æ—¥å¿—
    document.getElementById("toggleAddLog").onclick=()=>{
      document.getElementById("addLogBox").classList.toggle("hide");
    };
    document.getElementById("addLogSave").onclick=()=>{
      const text=document.getElementById("addLogText").value;
      if(!text.trim()) return;
      const firstLine=(text.split(/\r?\n/)[0]||"").trim();
      logs.push({title:firstLine,content:text});
      saveLogs(); renderLogs();
      document.getElementById("addLogText").value="";
      document.getElementById("addLogBox").classList.add("hide");
    };

    // æ’åºæ¨¡å¼
    let sortMode=false;
    document.getElementById("toggleSort").onclick=()=>{
      sortMode=!sortMode;
      document.getElementById("toggleSort").textContent=`ğŸ§­ æ’åºæ¨¡å¼ï¼š${sortMode?"å¼€":"å…³"}`;
      renderLogs();
    };

    // é¡¶éƒ¨å¯¼èˆª
    document.querySelectorAll(".tab").forEach(t=>{
      t.onclick=()=>{
        document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
        t.classList.add("active");
        document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
        document.getElementById("page-"+t.dataset.page).classList.add("active");
      };
    });

    renderLogs();
  </script>
</body>
</html>
