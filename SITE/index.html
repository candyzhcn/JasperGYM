<!doctype html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>训练提醒 v3.21</title>
  <style>
    body{margin:0;font-family:sans-serif;background:var(--bg);color:var(--ink);}
    .header{position:relative;z-index:5;background:#fff;display:flex;gap:8px;padding:8px}
    .tab{padding:6px 12px;cursor:pointer;border:1px solid #ccc;border-radius:6px;user-select:none}
    .tab.active{background:#2563eb;color:#fff}
    .page{display:none;padding:12px}
    .page.active{display:block}
    .btn{padding:4px 10px;margin:2px;cursor:pointer;border-radius:4px;border:1px solid #ccc}
    .btn.ok{background:#10b981;color:#fff}
    .btn.light{background:#eee}
    .btn.danger{background:#ef4444;color:#fff}
    .row.auto{display:flex;gap:8px;flex-wrap:wrap}
    textarea{min-height:160px;resize:vertical;width:100%}
    .log-content{margin-top:6px;white-space:pre-wrap;word-break:break-word}
    .log-editor .bigtext{min-height:320px;width:100%}
  </style>
</head>
<body>
  <div class="header">
    <div class="tab active" data-page="home">🏠 首页</div>
    <div class="tab" data-page="work">🏋️ 训练</div>
    <div class="tab" data-page="logs">📓 日志</div>
    <div class="tab" data-page="settings">⚙️ 设置</div>
  </div>

  <div id="page-home" class="page active">这里是首页</div>
  <div id="page-work" class="page">这里是训练页面</div>
  <div id="page-logs" class="page">
    <h2>日志</h2>
    <div id="logList"></div>
    <div class="row auto" style="margin-top:10px">
      <button class="btn ok" id="toggleAddLog">➕ 添加日志</button>
      <button class="btn light" id="toggleSort">🧭 排序模式：关</button>
    </div>
    <div class="card hide" id="addLogBox">
      <textarea id="addLogText" class="bigtext"></textarea>
      <button class="btn ok" id="addLogSave">保存</button>
    </div>
  </div>
  <div id="page-settings" class="page">这里是设置页面</div>

  <script>
    // 模拟存储
    let logs = JSON.parse(localStorage.getItem("logs")||"[]");
    function saveLogs(){ localStorage.setItem("logs",JSON.stringify(logs)); }

    // 渲染日志
    function renderLogs(){
      const list=document.getElementById("logList");
      list.innerHTML="";
      logs.forEach((log,i)=>{
        const div=document.createElement("div");
        div.className="log-item";
        div.innerHTML=`<b>${log.title||"（无标题）"}</b>`;
        const c=document.createElement("div");
        c.className="log-content";
        c.textContent=log.content||"（无内容）";
        div.appendChild(c);

        if(sortMode){
          const tools=document.createElement("div"); tools.className="log-tools";
          tools.innerHTML=`
            <button class="btn light">⬆️ 上移</button>
            <button class="btn light">⬇️ 下移</button>
            <button class="btn light">✏️ 编辑</button>
            <button class="btn danger">🗑 删除</button>`;
          const [upBtn,downBtn,editBtn,delBtn]=tools.querySelectorAll("button");

          // 编辑：原位大输入框
          editBtn.onclick=(e)=>{
            e.stopPropagation();
            const editor=document.createElement("div"); editor.className="log-editor";
            const ta=document.createElement("textarea"); ta.className="bigtext"; ta.value=log.content||"";
            const row=document.createElement("div"); row.className="row auto"; row.style.marginTop="8px";
            const saveBtn=document.createElement("button"); saveBtn.className="btn ok"; saveBtn.textContent="💾 保存";
            const cancelBtn=document.createElement("button"); cancelBtn.className="btn light"; cancelBtn.textContent="取消";
            row.appendChild(saveBtn); row.appendChild(cancelBtn);
            editor.appendChild(ta); editor.appendChild(row);
            c.classList.add("hide"); div.appendChild(editor);

            saveBtn.onclick=()=>{
              const newContent=ta.value;
              const firstLine=(newContent.split(/\r?\n/)[0]||"").trim()||"（无标题）";
              logs[i]={...logs[i], title:firstLine, content:newContent};
              saveLogs(); renderLogs();
            };
            cancelBtn.onclick=()=>{ editor.remove(); c.classList.remove("hide"); };
          };

          upBtn.onclick=()=>{ if(i>0){ [logs[i-1],logs[i]]=[logs[i],logs[i-1]]; saveLogs(); renderLogs(); } };
          downBtn.onclick=()=>{ if(i<logs.length-1){ [logs[i+1],logs[i]]=[logs[i],logs[i+1]]; saveLogs(); renderLogs(); } };
          delBtn.onclick=()=>{ if(confirm("删除？")){ logs.splice(i,1); saveLogs(); renderLogs(); } };
          div.appendChild(tools);
        }else{
          // 非排序模式：双击进入编辑
          div.ondblclick=()=>{
            const editor=document.createElement("div"); editor.className="log-editor";
            const ta=document.createElement("textarea"); ta.className="bigtext"; ta.value=log.content||"";
            const row=document.createElement("div"); row.className="row auto"; row.style.marginTop="8px";
            const saveBtn=document.createElement("button"); saveBtn.className="btn ok"; saveBtn.textContent="💾 保存";
            const cancelBtn=document.createElement("button"); cancelBtn.className="btn light"; cancelBtn.textContent="取消";
            row.appendChild(saveBtn); row.appendChild(cancelBtn);
            editor.appendChild(ta); editor.appendChild(row);
            c.classList.add("hide"); div.appendChild(editor);

            saveBtn.onclick=()=>{
              const newContent=ta.value;
              const firstLine=(newContent.split(/\r?\n/)[0]||"").trim()||"（无标题）";
              logs[i]={...logs[i], title:firstLine, content:newContent};
              saveLogs(); renderLogs();
            };
            cancelBtn.onclick=()=>{ editor.remove(); c.classList.remove("hide"); };
          };
        }
        list.appendChild(div);
      });
    }

    // 添加日志
    document.getElementById("toggleAddLog").onclick=()=>{
      document.getElementById("addLogBox").classList.toggle("hide");
    };
    document.getElementById("addLogSave").onclick=()=>{
      const text=document.getElementById("addLogText").value;
      if(!text.trim()) return;
      const firstLine=(text.split(/\r?\n/)[0]||"").trim();
      logs.push({title:firstLine,content:text});
      saveLogs(); renderLogs();
      document.getElementById("addLogText").value="";
      document.getElementById("addLogBox").classList.add("hide");
    };

    // 排序模式
    let sortMode=false;
    document.getElementById("toggleSort").onclick=()=>{
      sortMode=!sortMode;
      document.getElementById("toggleSort").textContent=`🧭 排序模式：${sortMode?"开":"关"}`;
      renderLogs();
    };

    // 顶部导航
    document.querySelectorAll(".tab").forEach(t=>{
      t.onclick=()=>{
        document.querySelectorAll(".tab").forEach(x=>x.classList.remove("active"));
        t.classList.add("active");
        document.querySelectorAll(".page").forEach(p=>p.classList.remove("active"));
        document.getElementById("page-"+t.dataset.page).classList.add("active");
      };
    });

    renderLogs();
  </script>
</body>
</html>
